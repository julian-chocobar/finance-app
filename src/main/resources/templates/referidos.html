<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lista de Referidos</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <h1>Referidos</h1>

    <!-- Formulario de búsqueda -->
    <form th:action="@{/referidos}" method="get">
        <input type="text" name="nombre" placeholder="Buscar por nombre" th:value="${nombreFiltro}">
        <button type="submit">Buscar</button>
    </form>

    <!-- Botón para mostrar el formulario de creación -->
    <button onclick="mostrarFormulario('crear')">Nuevo Referido</button>

    <!-- Formulario unificado para crear/editar un referido -->
    <div id="formulario-referido" style="display: none;">
        <form id="referidoForm" method="post">
            <label>Nombre:</label>
            <input type="text" id="nombre" name="nombre" required>

            <label>Teléfono:</label>
            <input type="text" id="telefono" name="telefono">

            <label>Email:</label>
            <input type="email" id="email" name="email">

            <label>Dirección:</label>
            <input type="text" id="direccion" name="direccion">

            <button type="submit">Guardar</button>
            <button type="button" onclick="cancelarEdicion()">Cancelar</button>
        </form>
    </div>

    <!-- Verifica si hay datos -->
    <div th:if="${referidos != null and !referidos.empty}">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Teléfono</th>
                    <th>Email</th>
                    <th>Dirección</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="referido : ${referidos.content}">
                    <td th:text="${referido.id}">1</td>
                    <td th:text="${referido.nombre}">Nombre</td>
                    <td th:text="${referido.telefono}">Teléfono</td>
                    <td th:text="${referido.email}">Email</td>
                    <td th:text="${referido.direccion}">Dirección</td>
                    <td>
						<button th:attr="onclick=|mostrarFormulario('editar', '${referido.id}', '${referido.nombre}', '${referido.telefono}', '${referido.email}', '${referido.direccion}')|">Editar</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
	
	    <!-- Paginación -->
	    <div th:if="${referidos.totalPages > 1}">
	        <span th:if="${!referidos.first}">
	            <a th:href="@{/referidos(page=0, size=${referidos.size})}">Primera</a>
	        </span>
	        <span th:if="${referidos.hasPrevious()}">
	            <a th:href="@{/referidos(page=${referidos.number - 1}, size=${referidos.size})}">Anterior</a>
	        </span>
	        <span th:each="i : ${#numbers.sequence(1, referidos.totalPages)}">
	            <a th:if="${i - 1 != referidos.number}" 
	               th:href="@{/referidos(page=${i - 1}, size=${referidos.size})}" 
	               th:text="${i}">1</a>
	            <span th:unless="${i - 1 != referidos.number}" th:text="${i}">1</span>
	        </span>
	        <span th:if="${referidos.hasNext()}">
	            <a th:href="@{/referidos(page=${referidos.number + 1}, size=${referidos.size})}">Siguiente</a>
	        </span>
	        <span th:if="${!referidos.last}">
	            <a th:href="@{/referidos(page=${referidos.totalPages - 1}, size=${referidos.size})}">Última</a>
	        </span>
	    </div>

	    <!-- Información de la paginación -->
	    <div>
	        <p>Página <span th:text="${referidos.number + 1}">1</span> de <span th:text="${referidos.totalPages}">1</span></p>
	        <p>Total de referidos: <span th:text="${referidos.totalElements}">0</span></p>
	    </div>
	</div>

    <script>
        function mostrarFormulario(modo, id = null, nombre = "", telefono = "", email = "", direccion = "") {
            const form = document.getElementById("referidoForm");

            if (modo === "crear") {
                form.action = "/referidos"; // URL para crear un nuevo referido
                form.method = "post";
            } else if (modo === "editar" && id) {
                form.action = "/referidos/editar/" + id; // URL con el ID en la ruta
                form.method = "post";
            }

            // Llenar los campos del formulario con datos si es edición
            document.getElementById("nombre").value = nombre;
            document.getElementById("telefono").value = telefono;
            document.getElementById("email").value = email;
            document.getElementById("direccion").value = direccion;

            document.getElementById("formulario-referido").style.display = "block";
        }

        function cancelarEdicion() {
            document.getElementById("formulario-referido").style.display = "none";
        }
    </script>
</body>
</html>
